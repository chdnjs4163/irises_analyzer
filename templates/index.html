<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ëŒ€í™”í˜• ë¶“ê½ƒ í’ˆì¢… ë¶„ì„ê¸°</title>
    <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        body { font-family: "Noto Sans KR", sans-serif; background-color: #f4f7f6; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .main-container { display: flex; flex-direction: column; gap: 20px; width: 100%; max-width: 1000px; }
        .panel { background-color: white; padding: 30px; border-radius: 16px; box-shadow: 0 8px 24px rgba(0,0,0,0.08); }
        h2 { color: #5d3a9b; margin-top: 0; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        label { font-weight: 500; display: block; margin-bottom: 8px; color: #333; }
        .form-inputs input { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; }
        button { background-color: #8a63d2; color: white; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: background-color 0.3s; padding: 12px 20px; }
        button:hover { background-color: #734bbd; }
        .button-group { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .example-btn { background-color: #f0eef6; color: #5d3a9b; border: 1px solid #dcd6e8; }
        #accuracy { font-size: 1.3rem; font-weight: bold; color: #333; text-align: center; margin-bottom: 15px; }
        #plot-container { min-height: 450px; display: flex; align-items: center; justify-content: center; color: #888; border: 1px dashed #ddd; border-radius: 8px; }
        .form-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        #prediction-result { text-align: center; margin-top: 20px; }
        #prediction-text { font-size: 1.5rem; color: #5d3a9b; font-weight: bold; }
        #prediction-image { max-width: 250px; border-radius: 12px; margin-top: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #8a63d2; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: auto;}
    </style>
</head>
<body>
    <div class="main-container">
        <div class="panel">
            <h2>1. ì‹¤ì‹œê°„ ì˜ˆì¸¡ê¸° ğŸŒ¸</h2>
            <p>ë¶“ê½ƒì˜ íŠ¹ì§•(cm)ì„ ì…ë ¥í•˜ì—¬ í’ˆì¢…ì„ ì˜ˆì¸¡í•´ë³´ì„¸ìš”.</p>
            <div class="control-group">
                <label>ì…ë ¥ ì˜ˆì‹œ:</label>
                <div class="button-group">
                    <button type="button" class="example-btn" onclick="fillPredictionValues('setosa')">Setosa</button>
                    <button type="button" class="example-btn" onclick="fillPredictionValues('versicolor')">Versicolor</button>
                    <button type="button" class="example-btn" onclick="fillPredictionValues('virginica')">Virginica</button>
                </div>
            </div>
            <form id="predict-form">
                <div class="form-inputs">
                    <input type="text" name="sl" placeholder="ê½ƒë°›ì¹¨ ê¸¸ì´ (cm)" required>
                    <input type="text" name="sw" placeholder="ê½ƒë°›ì¹¨ ë„ˆë¹„ (cm)" required>
                    <input type="text" name="pl" placeholder="ê½ƒì ê¸¸ì´ (cm)" required>
                    <input type="text" name="pw" placeholder="ê½ƒì ë„ˆë¹„ (cm)" required>
                </div>
                <button type="submit">í’ˆì¢… ì˜ˆì¸¡í•˜ê¸°</button>
            </form>
            <div id="prediction-result"></div>
        </div>
        <div class="panel">
            <h2>2. ëª¨ë¸ í•™ìŠµ ì‹œë®¬ë ˆì´í„° ğŸ¤–</h2>
            <p>ì´ê³³ì—ì„œëŠ” ì˜ˆì¸¡ì— ì‚¬ìš©ë˜ëŠ” ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì˜ í•™ìŠµ ê³¼ì •ì„ ì‹œë®¬ë ˆì´ì…˜í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <div class="control-group">
                <label>ì•Œê³ ë¦¬ì¦˜ë³„ í•™ìŠµ ì˜ˆì‹œ:</label>
                <div class="button-group">
                    <button class="example-btn" onclick="trainModel({algorithm: 'dt', test_size: 0.2})">ê²°ì • íŠ¸ë¦¬</button>
                    <button class="example-btn" onclick="trainModel({algorithm: 'knn', test_size: 0.3})">K-ìµœê·¼ì ‘ ì´ì›ƒ</button>
                    <button class="example-btn" onclick="trainModel({algorithm: 'lr', test_size: 0.3})">ë¡œì§€ìŠ¤í‹± íšŒê·€</button>
                </div>
            </div>
            <p id="accuracy">í•™ìŠµ ë²„íŠ¼ì„ ëˆŒëŸ¬ ëª¨ë¸ì„ ìƒì„±í•˜ì„¸ìš”.</p>
            <div id="plot-container"><p>ì´ê³³ì— í•™ìŠµ ê²°ê³¼ ê·¸ë˜í”„ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p></div>
        </div>
    </div>
    <script>
        const accuracyEl = document.getElementById('accuracy');
        const plotContainer = document.getElementById('plot-container');
        const predictForm = document.getElementById('predict-form');
        const predictionResultEl = document.getElementById('prediction-result');
        const spinner = '<div class="spinner"></div>';
        
        async function trainModel(params) {
            accuracyEl.textContent = 'ëª¨ë¸ì„ í•™ìŠµí•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...';
            plotContainer.innerHTML = spinner;

            const sl = document.querySelector('input[name="sl"]').value;
            const sw = document.querySelector('input[name="sw"]').value;
            const pl = document.querySelector('input[name="pl"]').value;
            const pw = document.querySelector('input[name="pw"]').value;

            if (sl && sw && pl && pw) {
                params.features = [sl, sw, pl, pw];
            }

            try {
                const response = await fetch('/train', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(params)
                });
                const result = await response.json();
                if (result.error) { throw new Error(result.error); }
                accuracyEl.textContent = `ëª¨ë¸ ì •í™•ë„: ${result.accuracy}`;
                const graphData = JSON.parse(result.graph_json);
                Plotly.newPlot('plot-container', graphData.data, graphData.layout);
            } catch (error) {
                accuracyEl.textContent = 'í•™ìŠµ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                plotContainer.innerHTML = `<p>ì˜¤ë¥˜: ${error}</p>`;
            }
        }
        
        predictForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            predictionResultEl.innerHTML = spinner;
            accuracyEl.textContent = 'ëª¨ë¸ í•™ìŠµ ë° ì˜ˆì¸¡ ì¤‘...';
            plotContainer.innerHTML = spinner;
            try {
                const formData = new FormData(predictForm);
                const response = await fetch('/predict', { method: 'POST', body: formData });
                const result = await response.json();
                if (result.error) { throw new Error(result.error); }
                predictionResultEl.innerHTML = `
                    <p id="prediction-text">ì˜ˆì¸¡ëœ í’ˆì¢…: ${result.prediction}</p>
                    <img id="prediction-image" src="${result.image_url}" alt="${result.prediction}">
                `;
                accuracyEl.textContent = `ëª¨ë¸ ì •í™•ë„: ${result.accuracy}`;
                const graphData = JSON.parse(result.graph_json);
                Plotly.newPlot('plot-container', graphData.data, graphData.layout);
            } catch (error) {
                 predictionResultEl.innerHTML = `<p style="color: red;">${error.message}</p>`;
                 plotContainer.innerHTML = `<p>ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì—¬ ê·¸ë˜í”„ë¥¼ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>`;
            }
        });

        function fillPredictionValues(species) {
            const exampleData = {
                'setosa':     { sl: 5.0, sw: 3.4, pl: 1.5, pw: 0.2 },
                'versicolor': { sl: 5.9, sw: 2.8, pl: 4.3, pw: 1.3 },
                'virginica':  { sl: 6.6, sw: 3.0, pl: 5.6, pw: 2.0 }
            };
            const data = exampleData[species];
            document.querySelector('input[name="sl"]').value = data.sl;
            document.querySelector('input[name="sw"]').value = data.sw;
            document.querySelector('input[name="pl"]').value = data.pl;
            document.querySelector('input[name="pw"]').value = data.pw;
        }

        document.addEventListener('DOMContentLoaded', () => {
            trainModel({algorithm: 'dt', test_size: 0.3});
        });
    </script>
</body>
</html>